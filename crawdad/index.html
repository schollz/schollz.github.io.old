<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Comparing scrapy with crawdad</title><meta name=description content><meta itemprop=name content="Comparing scrapy with crawdad"><meta itemprop=description content><meta name=twitter:card content=summary><meta name=twitter:title content="Comparing scrapy with crawdad"><meta name=twitter:description content><meta name=twitter:site content=@yakczar><meta name=twitter:creator content=@yakczar><meta name=og:title content="Comparing scrapy with crawdad"><meta name=og:description content><meta name=og:type content=website><style>body{margin:0 auto 1em auto;max-width:40em;padding:0 .62em;font:1.2em/1.62 sans-serif;color:#555}h1,h2,h3,strong{color:#333;line-height:1.2}a{color:#e81c4f}code{background-color:#f5f7f9}pre{color:#45484e;background:#f5f7f9;padding:1em;border-left:2px solid #69c;vertical-align:text-bottom;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}@media print{body{max-width:none}}img{width:100%}a,u{text-decoration:none}blockquote{font-style:italic;margin:1.5em 10px;padding:.5em 10px;quotes:"\201C""\201D""\2018""\2019"}blockquote:before{color:#ccc;content:open-quote;font-size:4em;line-height:.1em;margin-right:.25em;vertical-align:-.4em}blockquote p{display:inline}h1{font-size:1.5rem}@media screen and (min-width:30em) and (max-width:60em){h1{font-size:2.25rem}}@media screen and (min-width:60em){h1{font-size:3rem}}.twitter-tweet{display:inline-block;font-family:helvetica neue,Roboto,segoe ui,Calibri,sans-serif;font-size:12px;font-weight:700;line-height:16px;border-color:#eee #ddd #bbb;border-radius:5px;border-style:solid;border-width:1px;box-shadow:0 1px 3px rgba(0,0,0,.15);margin:10px 5px;padding:0 16px 16px;max-width:468px}.twitter-tweet p{font-size:16px;font-weight:400;line-height:20px}.twitter-tweet a{color:inherit;font-weight:400;text-decoration:none;outline:0 0}.twitter-tweet a:hover,.twitter-tweet a:focus{text-decoration:underline}.w3-tag{background-color:gray;color:#fff;display:inline-block;padding-left:4px;padding-right:4px;text-align:center;font-style:normal}figcaption{font-weight:400;font-style:italic;font-size:16px;line-height:1.3;color:#666665;outline:0;z-index:300;text-align:center}</style><script>function ready(fn){if(document.attachEvent?document.readyState==="complete":document.readyState!=="loading"){var elements=document.querySelectorAll("img");Array.prototype.forEach.call(elements,function(el,i){if(el.getAttribute("alt")){const caption=document.createElement('figcaption');var node=document.createTextNode(el.getAttribute("alt"));caption.appendChild(node);const wrapper=document.createElement('figure');wrapper.className='image';el.parentNode.insertBefore(wrapper,el);el.parentNode.removeChild(el);wrapper.appendChild(el);wrapper.appendChild(caption);console.log(el);console.log(el.outerHTML)}});}else{document.addEventListener('DOMContentLoaded',fn);}}
window.onload=ready;</script><img src="https://analytics.schollz.com/1.png?page=https%3a%2f%2fschollz.github.io%2fcrawdad%2f" width=1px height=1px style=float:right><p><small><a href=/ style=color:#000>/posts</a>&nbsp;&nbsp;·&nbsp;
<a href=/about/ style=color:#000>/about</a>&nbsp;&nbsp;·&nbsp;
<a href=/contact/ style=color:#000>/contact</a></small><header><a href=/tags/coding/ class=w3-tag>coding</a></header><article><h1>Comparing scrapy with crawdad</h1><p>Here I will compare scraping the same site, <a href=http://quotes.toscrape.com/>quotes.toscrape.com</a> with <em>crawdad</em> (my creation) and <em>scrapy</em> (the popular framework for scraping).<h2 id=using-scrapy>Using <em>scrapy</em></h2><p><img src=https://user-images.githubusercontent.com/6550035/31486741-b06865e4-aef5-11e7-8b0d-c5ed107b25b4.png alt="scrapy is really useful tool to get started in scraping."><p><em>scrapy</em> is powerful, but complicated. Lets follow the tutorial to get a baseline on how a scrapy should run.<h3 id=install>Install</h3><p>First install <em>scrapy</em> by installing the dependencies (there are a lot of dependencies).<pre><code class=language-sh>$ sudo apt-get install python-dev python-pip libxml2-dev libxslt1-dev zlib1g-dev libffi-dev libssl-dev
$ sudo -H python3 -m pip install --upgrade scrapy
</code></pre><p>Once you get it install you can check the version:<pre><code class=language-sh>$ scrapy -version
Scrapy 1.4.0 - project: quotesbot
</code></pre><h3 id=build-scraper>Build scraper</h3><p>Actually, I will just use the <a href=https://github.com/scrapy/quotesbot>tutorial of <em>scrapy</em></a> to skip building it myself.<pre><code class=language-sh>$ git clone https://github.com/scrapy/quotesbot.git
$ cd quotesbot
</code></pre><p><em>scrapy</em> is not simple. It requires &gt; 40 lines of Python code in several different files (<code>items.py</code>, <code>pipelines.py</code>, <code>settings.py</code>, <code>spiders/toscrape-css.py</code>).<h3 id=run>Run</h3><p>Lets run and time the result:<pre><code>$ time scrapy crawl toscrape-xpath -o quotes.json
1.16s user 0.09s system 26% cpu 4.728 total
</code></pre><p>Scraping is fast! Only about 4-5 seconds for the 11 pages!<h2 id=using-crawdad>Using <em>crawdad</em></h2><p><img src=https://user-images.githubusercontent.com/6550035/31456157-58663efe-ae76-11e7-8e53-6a2a5b7a196c.png alt="Crawdads crawl around and pinch you."><p><em>crawdad</em> is a simple, yet powerful alternative for scraping in a distributed, persistent manner (since its backed by Redis).<h3 id=install-1>Install</h3><p>First <a href=https://www.docker.com/community-edition>get Docker</a> which will be used for running Redis. Then you can simply download <em>crawdad</em>:<pre><code class=language-sh>$ wget https://github.com/schollz/crawdad/releases/download/v3.0.0/crawdad_3.0.0_linux_amd64.zip
$ unzip crawdad*zip
$ sudo mv crawdad*amd64 /usr/local/bin/crawdad
</code></pre><p>Unlike <em>scrapy</em>, <em>crawdad</em> is a single binary that has no dependencies.<h2 id=build-scraper-1>Build scraper</h2><p><em>scrapy</em> does require some coding. It requires writing a TOML file in order to scrape the webpage. Here is the TOML for quotes.toscrape.com. Read more about pluck TOML files <a href=https://github.com/schollz/pluck#use-config-file>here</a>. Essentially they can be written without knowing any CSS or HTML and are intuitive for grabbing data.</p><script src=https://gist.github.com/schollz/02205b5c1a3c5ade132e17ce61ce1213.js></script><p>Basically you are telling the computer to find all the &ldquo;activators&rdquo; and collect the text until a &ldquo;deactivator&rdquo;. This is completely code-agnostic, and can be determined simply by looking at the HTML/CSS of the webpage.<h3 id=run-1>Run</h3><p>First, start Redis with Docker:<pre><code class=language-sh>$ docker run -d -p 6374:6379 redis
</code></pre><p>and then start <em>crawdad</em>:<pre><code>$ time crawdad -p 6374 -set -u http://quotes.toscrape.com -pluck quotes.toml -include '/page/' -exclude '/tag/'
0.26s user 0.07s system 9% cpu 3.510 total
</code></pre><p><em>crawdad</em> is a little faster, completing in less than 4 seconds for the same data.<p>The data from <em>crawdad</em> can be parsed in the same as <em>scrapy</em> by first dumping it,<pre><code>$ crawdad -p 6374 -done done.json
</code></pre><p>The data, <code>done.json</code>, contains each URL as a key and the data it extracted. It needs to be quickly parsed, too, which can be done lickity-split in Python in 12 lines of code:</p><script src=https://gist.github.com/schollz/f27547bb4716fc14fd574e9bbdad57a1.js></script><h2 id=thoughts>Thoughts</h2><p><em>crawdad</em> has some other mighty benefits as well. Once initiated, you can run another crawdad on a different machine:<pre><code class=language-sh>$ crawdad -p 6374 -s X.X.X.X
</code></pre><p>This will start crawling using the same parameters as the first <em>crawdad</em>, but will pull from the queue.<p>Also, since it is backed by Redis, <em>crawdad</em> is resilient to interruptions and allows you to restart from the point that it was interrupted.</article><footer><p><small><em>Written October 11, 2017.</em></small><p><small>Leave a comment for me on Twitter <a href="https://twitter.com/intent/tweet?text=%40yakcar%20%23crawdad%20">@yakczar</a>.</small></footer><a href=/docker-news/>← Read news in the terminal with Docker</a>&nbsp;<a href=/music-2017/ style=float:right>Favorite music of 2017 →</a>