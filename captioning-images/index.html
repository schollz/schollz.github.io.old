<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Automatic captioning of images using Javascript</title><meta name=description content><meta itemprop=name content="Automatic captioning of images using Javascript"><meta itemprop=description content><meta name=twitter:card content=summary><meta name=twitter:title content="Automatic captioning of images using Javascript"><meta name=twitter:description content><meta name=twitter:site content=@yakczar><meta name=twitter:creator content=@yakczar><meta name=og:title content="Automatic captioning of images using Javascript"><meta name=og:description content><meta name=og:type content=website><link rel=stylesheet href=/css/style.css><script src=/js/caption.js></script><img src="https://analytics.schollz.com/1.png?page=https%3a%2f%2fschollz.github.io%2fcaptioning-images%2f" width=1px height=1px style=float:right><div id=loadingMask style=width:100%;height:100%;position:fixed;background:#fff></div><script>function fadeOut(el){el.style.opacity=1;var last=+new Date();var tick=function(){el.style.opacity=+el.style.opacity-(new Date()-last)/80;last=+new Date();if(el.style.opacity>0){(window.requestAnimationFrame&&requestAnimationFrame(tick))||setTimeout(tick,16);}else{el.style.display='none';}};tick();}
function ready(fn){if(document.attachEvent?document.readyState==="complete":document.readyState!=="loading"){el=document.getElementById('loadingMask');fadeOut(el);var elements=document.querySelectorAll("img");Array.prototype.forEach.call(elements,function(el,i){if(el.getAttribute("alt")){const caption=document.createElement('figcaption');var node=document.createTextNode(el.getAttribute("alt"));caption.appendChild(node);const wrapper=document.createElement('figure');wrapper.className='image';el.parentNode.insertBefore(wrapper,el);el.parentNode.removeChild(el);wrapper.appendChild(el);wrapper.appendChild(caption);}});}else{document.addEventListener('DOMContentLoaded',fn);}}
window.onload=ready;</script><div class=content><h1>Automatic captioning of images using Javascript<aside><a href=/tags/coding/ class=w3-tag>/coding</a>&nbsp;&nbsp;&nbsp;<a href=/about class=w3-tag>/about</a></aside></h1><p>I like to caption my images and I like to write in Markdown. However, it is
currently <em>not</em> possible to make captioned images, i.e. make
<a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/figure>an HTML figure</a>
using just Markdown - at least at the current spec (<a href=http://spec.commonmark.org/0.27/#images>version
0.27</a>) at the time of this writing. Of course, Markdown
supports HTML, so you could just write a &ldquo;<code>&lt;figure&gt;</code>&rdquo; tag everywhere
instead of writing with the Markdown &ldquo;<code>![]()</code>&rdquo; image syntax. However, I want to use the
&ldquo;<code>![]()</code>&rdquo; syntax! So, here is a nice trick for captioning images using only the Markdown syntax with a little vanilla Javascript.<p><img src=/img/worms.svg alt="This picture of worms has a caption!"><p>The trick is to use Javascript to find images with non-zero <code>alt</code> attributes and convert them to figures with the caption filled in with the content of the <code>alt</code> attribute. Someone came up with this before me, and <a href=https://blog.kchung.co/adding-image-captions-to-ghost/>here is their script</a>:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>$</span><span>(</span><span style=color:#e6db74>&#34;.post-content img&#34;</span><span>).</span><span style=color:#a6e22e>each</span><span>(</span><span>
</span><span></span><span style=color:#66d9ef>function</span><span>()</span><span> </span><span>{</span><span>
</span><span>    </span><span style=color:#66d9ef>if</span><span> </span><span>(</span><span style=color:#a6e22e>$</span><span>(</span><span style=color:#66d9ef>this</span><span>).</span><span style=color:#a6e22e>attr</span><span>(</span><span style=color:#e6db74>&#34;alt&#34;</span><span>))</span><span> </span><span>{</span><span>
</span><span>        </span><span style=color:#a6e22e>$</span><span>(</span><span style=color:#66d9ef>this</span><span>).</span><span style=color:#a6e22e>wrap</span><span>(</span><span>
</span><span>            </span><span style=color:#e6db74>&#39;&lt;figure class=&#34;image&#34;&gt;&lt;/figure&gt;&#39;</span><span>
</span><span>        </span><span>).</span><span style=color:#a6e22e>after</span><span>(</span><span>
</span><span>            </span><span style=color:#e6db74>&#39;&lt;figcaption&gt;&#39;</span><span> </span><span style=color:#f92672>+</span><span>
</span><span>            </span><span style=color:#a6e22e>$</span><span>(</span><span style=color:#66d9ef>this</span><span>).</span><span style=color:#a6e22e>attr</span><span>(</span><span>
</span><span>                </span><span style=color:#e6db74>&#34;alt&#34;</span><span>)</span><span> </span><span style=color:#f92672>+</span><span>
</span><span>            </span><span style=color:#e6db74>&#39;&lt;/figcaption&gt;&#39;</span><span>
</span><span>        </span><span>);</span><span>
</span><span>    </span><span>}</span><span>
</span><span></span><span>});</span><span> </span><span style=color:#960050;background-color:#1e0010>// from https://blog.kchung.co/adding-image-captions-to-ghost/</span></code></pre></div><p>It works great, but it requires JQuery. I don&rsquo;t want to use JQuery so I carefully followed
<a href=https://github.com/oneuijs/You-Dont-Need-jQuery>oneuijs/You-Dont-Need-jQuery</a>
and I was able to convert this to just plain Javascript:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>function</span><span> </span><span style=color:#a6e22e>ready</span><span>(</span><span style=color:#a6e22e>fn</span><span>)</span><span> </span><span>{</span><span>
</span><span>    </span><span style=color:#66d9ef>if</span><span> </span><span>(</span><span>document</span><span>.</span><span style=color:#a6e22e>attachEvent</span><span> </span><span style=color:#f92672>?</span><span> </span><span>document</span><span>.</span><span style=color:#a6e22e>readyState</span><span> </span><span style=color:#f92672>===</span><span> </span><span style=color:#e6db74>&#34;complete&#34;</span><span> </span><span style=color:#f92672>:</span><span>
</span><span>        </span><span>document</span><span>.</span><span style=color:#a6e22e>readyState</span><span> </span><span style=color:#f92672>!==</span><span> </span><span style=color:#e6db74>&#34;loading&#34;</span><span>)</span><span> </span><span>{</span><span>
</span><span>        </span><span style=color:#66d9ef>var</span><span> </span><span style=color:#a6e22e>elements</span><span> </span><span style=color:#f92672>=</span><span> </span><span>document</span><span>.</span><span style=color:#a6e22e>querySelectorAll</span><span>(</span><span style=color:#e6db74>&#34;img&#34;</span><span>);</span><span>
</span><span>        </span><span>Array</span><span>.</span><span style=color:#a6e22e>prototype</span><span>.</span><span style=color:#a6e22e>forEach</span><span>.</span><span style=color:#a6e22e>call</span><span>(</span><span style=color:#a6e22e>elements</span><span>,</span><span> </span><span style=color:#66d9ef>function</span><span>(</span><span style=color:#a6e22e>el</span><span>,</span><span> </span><span style=color:#a6e22e>i</span><span>)</span><span> </span><span>{</span><span>
</span><span>            </span><span style=color:#66d9ef>if</span><span> </span><span>(</span><span style=color:#a6e22e>el</span><span>.</span><span style=color:#a6e22e>getAttribute</span><span>(</span><span style=color:#e6db74>&#34;alt&#34;</span><span>))</span><span> </span><span>{</span><span>
</span><span>                </span><span style=color:#66d9ef>const</span><span> </span><span style=color:#a6e22e>caption</span><span> </span><span style=color:#f92672>=</span><span> </span><span>document</span><span>.</span><span style=color:#a6e22e>createElement</span><span>(</span><span style=color:#e6db74>&#39;figcaption&#39;</span><span>);</span><span>
</span><span>                </span><span style=color:#66d9ef>var</span><span> </span><span style=color:#a6e22e>node</span><span> </span><span style=color:#f92672>=</span><span> </span><span>document</span><span>.</span><span style=color:#a6e22e>createTextNode</span><span>(</span><span style=color:#a6e22e>el</span><span>.</span><span style=color:#a6e22e>getAttribute</span><span>(</span><span style=color:#e6db74>&#34;alt&#34;</span><span>));</span><span>
</span><span>                </span><span style=color:#a6e22e>caption</span><span>.</span><span style=color:#a6e22e>appendChild</span><span>(</span><span style=color:#a6e22e>node</span><span>);</span><span>
</span><span>                </span><span style=color:#66d9ef>const</span><span> </span><span style=color:#a6e22e>wrapper</span><span> </span><span style=color:#f92672>=</span><span> </span><span>document</span><span>.</span><span style=color:#a6e22e>createElement</span><span>(</span><span style=color:#e6db74>&#39;figure&#39;</span><span>);</span><span>
</span><span>                </span><span style=color:#a6e22e>wrapper</span><span>.</span><span style=color:#a6e22e>className</span><span> </span><span style=color:#f92672>=</span><span> </span><span style=color:#e6db74>&#39;image&#39;</span><span>;</span><span>
</span><span>                </span><span style=color:#a6e22e>el</span><span>.</span><span style=color:#a6e22e>parentNode</span><span>.</span><span style=color:#a6e22e>insertBefore</span><span>(</span><span style=color:#a6e22e>wrapper</span><span>,</span><span> </span><span style=color:#a6e22e>el</span><span>);</span><span>
</span><span>                </span><span style=color:#a6e22e>el</span><span>.</span><span style=color:#a6e22e>parentNode</span><span>.</span><span style=color:#a6e22e>removeChild</span><span>(</span><span style=color:#a6e22e>el</span><span>);</span><span>
</span><span>                </span><span style=color:#a6e22e>wrapper</span><span>.</span><span style=color:#a6e22e>appendChild</span><span>(</span><span style=color:#a6e22e>el</span><span>);</span><span>
</span><span>                </span><span style=color:#a6e22e>wrapper</span><span>.</span><span style=color:#a6e22e>appendChild</span><span>(</span><span style=color:#a6e22e>caption</span><span>);</span><span>
</span><span>            </span><span>}</span><span>
</span><span>        </span><span>});</span><span>
</span><span>    </span><span>}</span><span> </span><span style=color:#66d9ef>else</span><span> </span><span>{</span><span>
</span><span>        </span><span>document</span><span>.</span><span style=color:#a6e22e>addEventListener</span><span>(</span><span style=color:#e6db74>&#39;DOMContentLoaded&#39;</span><span>,</span><span> </span><span style=color:#a6e22e>fn</span><span>);</span><span>
</span><span>    </span><span>}</span><span>
</span><span></span><span>}</span><span>
</span><span></span><span>window</span><span>.</span><span style=color:#a6e22e>onload</span><span> </span><span style=color:#f92672>=</span><span> </span><span style=color:#a6e22e>ready</span><span>;</span></code></pre></div><p>Of course this looks a little more complicated, but it works just the
same.<p>The only issue here is that when you load a page you will see all the figures &ldquo;jump&rdquo; into place as the captions are written to them, about one hundred milliseconds after the page loads. To avoid this, you can cover up the page until it is totally ready with a div:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span>&lt;</span><span></span><span style=color:#f92672>div</span><span> </span><span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span></span><span style=color:#e6db74>&#34;loadingMask&#34;</span><span> </span><span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span></span><span style=color:#e6db74>&#34;width: 100%; height: 100%; position: fixed; background: #fff;&#34;</span><span></span><span></span><span>&gt;&lt;</span><span></span><span>/</span><span></span><span style=color:#f92672>div</span><span></span><span>&gt;</span></code></pre></div><p>Then you can add a fade out to this div in the Javascript <code>ready()</code> function:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>el</span><span> </span><span style=color:#f92672>=</span><span> </span><span>document</span><span>.</span><span style=color:#a6e22e>getElementById</span><span>(</span><span style=color:#e6db74>&#39;loadingMask&#39;</span><span>);</span><span>
</span><span></span><span style=color:#a6e22e>fadeOut</span><span>(</span><span style=color:#a6e22e>el</span><span>);</span></code></pre></div><p>The <code>fadeOut()</code> function is adapted from the <a href=http://youmightnotneedjquery.com/>youmightnotneedjquery.com</a> <code>fadeIn()</code> function:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>function</span><span> </span><span style=color:#a6e22e>fadeOut</span><span>(</span><span style=color:#a6e22e>el</span><span>)</span><span> </span><span>{</span><span>
</span><span>  </span><span style=color:#a6e22e>el</span><span>.</span><span style=color:#a6e22e>style</span><span>.</span><span style=color:#a6e22e>opacity</span><span> </span><span style=color:#f92672>=</span><span> </span><span style=color:#ae81ff>1</span><span>;</span><span>
</span><span>
</span><span>  </span><span style=color:#66d9ef>var</span><span> </span><span style=color:#a6e22e>last</span><span> </span><span style=color:#f92672>=</span><span> </span><span style=color:#f92672>+</span><span style=color:#66d9ef>new</span><span> </span><span>Date</span><span>();</span><span>
</span><span>  </span><span style=color:#66d9ef>var</span><span> </span><span style=color:#a6e22e>tick</span><span> </span><span style=color:#f92672>=</span><span> </span><span style=color:#66d9ef>function</span><span>()</span><span> </span><span>{</span><span>
</span><span>    </span><span style=color:#a6e22e>el</span><span>.</span><span style=color:#a6e22e>style</span><span>.</span><span style=color:#a6e22e>opacity</span><span> </span><span style=color:#f92672>=</span><span> </span><span style=color:#f92672>+</span><span style=color:#a6e22e>el</span><span>.</span><span style=color:#a6e22e>style</span><span>.</span><span style=color:#a6e22e>opacity</span><span> </span><span style=color:#f92672>-</span><span> </span><span>(</span><span style=color:#66d9ef>new</span><span> </span><span>Date</span><span>()</span><span> </span><span style=color:#f92672>-</span><span> </span><span style=color:#a6e22e>last</span><span>)</span><span> </span><span style=color:#960050;background-color:#1e0010>/ 80;</span><span>
</span><span>    </span><span style=color:#a6e22e>last</span><span> </span><span style=color:#f92672>=</span><span> </span><span style=color:#f92672>+</span><span style=color:#66d9ef>new</span><span> </span><span>Date</span><span>();</span><span>
</span><span>    </span><span style=color:#75715e>// console.log(el.style.opacity);
</span><span style=color:#75715e></span><span>
</span><span>    </span><span style=color:#66d9ef>if</span><span> </span><span>(</span><span style=color:#a6e22e>el</span><span>.</span><span style=color:#a6e22e>style</span><span>.</span><span style=color:#a6e22e>opacity</span><span> </span><span style=color:#f92672>&gt;</span><span> </span><span style=color:#ae81ff>0</span><span>)</span><span> </span><span>{</span><span>
</span><span>      </span><span>(</span><span>window</span><span>.</span><span style=color:#a6e22e>requestAnimationFrame</span><span> </span><span style=color:#f92672>&amp;&amp;</span><span> </span><span style=color:#a6e22e>requestAnimationFrame</span><span>(</span><span style=color:#a6e22e>tick</span><span>))</span><span> </span><span style=color:#f92672>||</span><span> </span><span style=color:#a6e22e>setTimeout</span><span>(</span><span style=color:#a6e22e>tick</span><span>,</span><span> </span><span style=color:#ae81ff>16</span><span>);</span><span>
</span><span>    </span><span>}</span><span> </span><span style=color:#66d9ef>else</span><span> </span><span>{</span><span>
</span><span>        </span><span style=color:#a6e22e>el</span><span>.</span><span style=color:#a6e22e>style</span><span>.</span><span style=color:#a6e22e>display</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;none&#39;</span><span>;</span><span>
</span><span>    </span><span>}</span><span>
</span><span>  </span><span>};</span><span>
</span><span>
</span><span>  </span><span style=color:#a6e22e>tick</span><span>();</span><span>
</span><span></span><span>}</span></code></pre></div><p>Go ahead and copy that to whatever site you want! The full code is <a href=https://gist.github.com/schollz/ecc814acfa546721acdb9e55107b7277>here</a>.</div><footer><p><small><em>Written September 27, 2017.</em>
Send feedback to <a href="https://twitter.com/intent/tweet?text=%40yakczar%20%23captioning-images%20">@yakczar</a>.</small><p><a href=/ice-cubes/>← How much ice do you need?</a>&nbsp;
<a href=/docker-news/ style=float:right>Read news in the terminal with Docker →</a></footer>